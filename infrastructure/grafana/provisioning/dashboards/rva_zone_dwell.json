{
  "uid": "rva_zone_dwell",
  "title": "RVA - Zone Analytics",
  "description": "Ph√¢n t√≠ch h√†nh vi theo v√πng (zone) - Heatmap & Dwell Time",
  "editable": true,
  "schemaVersion": 38,
  "version": 5,
  "time": { "from": "now-6h", "to": "now" },
  "refresh": "30s",
  "templating": { "list": [] },
  "panels": [
    {
      "id": 1,
      "type": "stat",
      "title": "T·ªïng Visits",
      "description": "T·ªïng s·ªë l∆∞·ª£t gh√© thƒÉm c√°c zone",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 5, "w": 6, "x": 0, "y": 0 },
      "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "thresholds": { "steps": [{"color": "green", "value": null}] }, "unit": "short" } },
      "targets": [{ "refId": "A", "rawSql": "SELECT COALESCE(SUM(visits),0) AS value FROM lakehouse.rva.gold_zone_dwell" }]
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Avg Dwell Time",
      "description": "Th·ªùi gian d·ª´ng ch√¢n trung b√¨nh (gi√¢y)",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 5, "w": 6, "x": 6, "y": 0 },
      "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "thresholds": { "steps": [{"color": "blue", "value": null}, {"color": "yellow", "value": 30}, {"color": "red", "value": 60}] }, "unit": "s", "decimals": 1 } },
      "targets": [{ "refId": "A", "rawSql": "SELECT COALESCE(AVG(avg_dwell_seconds),0) AS value FROM lakehouse.rva.gold_zone_dwell" }]
    },
    {
      "id": 3,
      "type": "stat",
      "title": "Active Zones",
      "description": "S·ªë zone c√≥ ho·∫°t ƒë·ªông",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 5, "w": 6, "x": 12, "y": 0 },
      "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "thresholds": { "steps": [{"color": "purple", "value": null}] } } },
      "targets": [{ "refId": "A", "rawSql": "SELECT COUNT(*) AS value FROM lakehouse.rva.gold_zone_dwell" }]
    },
    {
      "id": 4,
      "type": "stat",
      "title": "Max Dwell (Hotspot)",
      "description": "Zone c√≥ th·ªùi gian d·ª´ng l√¢u nh·∫•t",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 5, "w": 6, "x": 18, "y": 0 },
      "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "thresholds": { "steps": [{"color": "red", "value": null}] }, "unit": "s", "decimals": 1 } },
      "targets": [{ "refId": "A", "rawSql": "SELECT COALESCE(MAX(avg_dwell_seconds),0) AS value FROM lakehouse.rva.gold_zone_dwell" }]
    },
    {
      "id": 5,
      "type": "bargauge",
      "title": "üî• Top 15 Zones - Dwell Time cao nh·∫•t",
      "description": "C√°c zone ng∆∞·ªùi d·ª´ng l·∫°i l√¢u nh·∫•t (hotspots)",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 5 },
      "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "unit": "s", "thresholds": { "mode": "absolute", "steps": [{"color": "green", "value": null}] } } },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "color", "minVizWidth": 8, "minVizHeight": 16, "namePlacement": "auto" },
      "transformations": [{ "id": "rowsToFields", "options": { "mappings": [{ "fieldName": "zone", "handlerKey": "field.name" }, { "fieldName": "dwell_seconds", "handlerKey": "field.value" }] } }],
      "targets": [{ "refId": "A", "rawSql": "SELECT concat('Zone (', cast(zone_x as varchar), ',', cast(zone_y as varchar), ')') AS zone, avg_dwell_seconds AS dwell_seconds\nFROM lakehouse.rva.gold_zone_dwell\nORDER BY avg_dwell_seconds DESC\nLIMIT 15" }]
    },
    {
      "id": 6,
      "type": "bargauge",
      "title": "üë• Top 15 Zones - Visits cao nh·∫•t",
      "description": "C√°c zone c√≥ l∆∞·ª£t gh√© thƒÉm nhi·ªÅu nh·∫•t",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 5 },
      "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "thresholds": { "mode": "absolute", "steps": [{"color": "blue", "value": null}] } } },
      "options": { "orientation": "horizontal", "displayMode": "gradient", "showUnfilled": true, "valueMode": "color", "minVizWidth": 8, "minVizHeight": 16, "namePlacement": "auto" },
      "transformations": [{ "id": "rowsToFields", "options": { "mappings": [{ "fieldName": "zone", "handlerKey": "field.name" }, { "fieldName": "visits", "handlerKey": "field.value" }] } }],
      "targets": [{ "refId": "A", "rawSql": "SELECT concat('Zone (', cast(zone_x as varchar), ',', cast(zone_y as varchar), ')') AS zone, visits\nFROM lakehouse.rva.gold_zone_dwell\nORDER BY visits DESC\nLIMIT 15" }]
    },
    {
      "id": 7,
      "type": "table",
      "title": "üìä Heatmap Data - Zone Grid (10x10)",
      "description": "Chi ti·∫øt hits v√† unique tracks theo t·ª´ng zone trong grid 10x10",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 15 },
      "fieldConfig": {
        "overrides": [
          { "matcher": { "id": "byName", "options": "hits" }, "properties": [{ "id": "custom.cellOptions", "value": { "type": "color-background", "mode": "gradient" } }] }
        ]
      },
      "options": { "showHeader": true, "footer": { "show": true, "reducer": ["sum"] } },
      "targets": [{ "refId": "A", "rawSql": "SELECT zone_x, zone_y, hits, unique_tracks\nFROM lakehouse.rva.gold_zone_heatmap\nORDER BY hits DESC\nLIMIT 50" }]
    },
    {
      "id": 8,
      "type": "table",
      "title": "üìã Zone Dwell Details",
      "description": "Th√¥ng tin chi ti·∫øt dwell time theo zone",
      "datasource": "Trino Lakehouse",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 15 },
      "fieldConfig": {
        "overrides": [
          { "matcher": { "id": "byName", "options": "avg_dwell_seconds" }, "properties": [{ "id": "unit", "value": "s" }, { "id": "decimals", "value": 1 }] },
          { "matcher": { "id": "byName", "options": "total_dwell_seconds" }, "properties": [{ "id": "unit", "value": "s" }, { "id": "decimals", "value": 1 }] }
        ]
      },
      "options": { "showHeader": true, "footer": { "show": true, "reducer": ["mean"] } },
      "targets": [{ "refId": "A", "rawSql": "SELECT store_id, camera_id, zone_x, zone_y, visits, total_dwell_seconds, avg_dwell_seconds\nFROM lakehouse.rva.gold_zone_dwell\nORDER BY visits DESC\nLIMIT 50" }]
    }
  ]
}
